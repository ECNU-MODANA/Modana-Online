<!doctype html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"/>
        <title>
            登录
        </title>
        <link rel="stylesheet" href="assets/css/bootstrap.css"/>
        <link rel="stylesheet" href="assets/css/signin.css">
        <link rel="stylesheet" href="assets/css/homenewlayout.css"/>
        </head>
        <body class="home-layout ">
<script src="assets/plugins/jQuery/jQuery-2.1.4.min.js"></script>

<header class="light">
     <div class="nav-left">
     <h1 style="text-indent:-9999em;font-size:0;margin:0;'">睿冷云-冷链行业最权威的信息平台
         <a href="http://www.liankur.com/#/home" class="logo" title='睿冷云-冷链行业最权威的信息平台'>
         </a>
     </h1>
     </div>
     <div class="nav-right mw-8" style="margin-right:40px;">
         <ul class="nav nav-right black-850">
             <li>
                 <a href="http://www.liankur.com/#/home">
                     首页
                 </a>
             </li>
             <li>
                 <a href="http://www.liankur.com/#/coldStoragelist">
                     找库
                 </a>
             </li>
             <li>
                 <a href="http://www.liankur.com/#/coldShareComment" >
                     共享
                 </a>
             </li>
             <li>
                 <a href="http://www.liankur.com/#/search">
                     追溯
                 </a>
             </li>
             <li>
                 <a href="" ng-click="gotoSmartCold()" target="view_frame">
                     冷库360
                 </a>
             </li>
         </ul>
         <ul class="navShow navPo show-850">        
                        <li class="oneNav">
                            <span class="glyphicon glyphicon-align-justify"></span>
                            <ol class="twoNav">
                                <li>
		                            <a href="#/home">
		                                首页
		                            </a>
		                        </li>
		                        <li>
		                            <a href="" ng-click="toColdStorageList()">
		                                找库
		                            </a>
		                        </li>
		                        <li>
		                            <a href="" ng-click="toColdShareComment()">
		                                共享
		                            </a>
		                        </li>
		                        <li>
		                            <a href="#/search">
		                                追溯
		                            </a>
		                        </li>
		                        <li>
		                            <a href="" ng-click="gotoSmartCold()" target="view_frame">
                                        冷库360
		                            </a>
		                        </li>
                            </ol>
                        </li>
                    </ul>
     </div>
 </header>

<div class="wrapper">
<div class="wrapper user-common-wrapper">
    <div class="main-center">
        <h1 class="user-common-title" style="color: #428bca" >
            登录
        </h1>
        <div class="main-form-container">
            <form id="loginFrm" class="user-common-form" role="form" method="post" >
                <h4 class="user-common-h4"></h4>
                <div class="form-group">
                    <input type="text" class="form-control" name="username" id="username" placeholder='用户名'>
                    <!-- 错误信息 popover -->
                    <div class="err-popover-out">
                        <div class="err-popover">
                            <div class="tri-right"></div>
                            <div class="tri-right-in"></div>
                            <div class="err-popover-content"></div>
                        </div>
                    </div>
                    <!-- 错误信息 popover end -->
                </div>
                <div class="form-group">
                    <input type="password" class="form-control" id="password" name="password" placeholder='密码'>
                    <!-- 错误信息 popover -->
                    <div class="err-popover-out">
                        <div class="err-popover">
                            <div class="tri-right"></div>
                            <div class="tri-right-in"></div>
                            <div class="err-popover-content"></div>
                        </div>
                    </div>
                    <!-- 错误信息 popover end -->
                </div>
                <button type="button" id="submit" class="btn btn-form-common form-control" onclick="login();"><span>登录</span></button>
                <div class="checkbox no-padding">
                    <a href="" class="a text-left">忘记密码?</a>
                    <a href="signup.html" class="a pull-right">注册</a>
                </div>
                <div class="row">
		          <div class="col-xs-8">
		            <a style="color:red" hidden=true id="mention"></a>
		          </div>
		        </div>
            </form>
            
        </div>
    </div>

</div>
</div>
<script  type="text/javascript">
// 	$(document).ready(function() {
// 	    $.ajax({
// 	        url: "/i/user/findUser",
// 	        async: false,
// 	        cache: false
// 	    }).success(function(data) {
// 	        if (data.success && data.entity.id != 0) {
// 	            window.location.href = "http://" + window.location.host + "/#/home";
// 	        }
// 	    });
// 	});
	function showErrorInfo(msg) {
	    var msgEl = $("#mention");
	    if (msg == null || msg == '') {
	        msgEl.hide();
	        msgEl.html('');
	    } else {
	        msgEl.show();
	        msgEl.html(msg);
	    }
	}
	function login() {
	    var me = "#submit";
	    if ($(me).data('isLoading') === true) return; //防止再次点击登录
	    showErrorInfo("");
	    userName = $("#username").val();
	    password = $('#password').val();
	    if (userName == '') {
	        showErrorInfo("用户名不能为空~");
	        return;
	    } else if (password == '') {
	        showErrorInfo("密码不能为空~");
	        return;
	    }
	    $(me).text("登录中...");
	    $(me).data('isLoading', true);
	       $.ajax({
				type : "POST",
				dataType : "json",
				url : "/i/user/login",
				data : {userName : userName,password : password},
				complete : function(e){$(me).text("登录"); $(me).delay(500).data('isLoading',false);},
				success : function(data) {
					if (data.success) {
                        document.cookie = data.message;
						if (window.location.hash != "") {
							backUrl = window.location.hash;
						} else {
							backUrl = "#/home";
						}
						window.location.href = "http://"+ window.location.host + "/"+ backUrl;
						window.Event.returnValue = false;
					} else {
					    $("#mention")[0].hidden = false;
						showErrorInfo(data.message);
					}
				}
			});
	    
	};
	
	$('.navShow>li').hover(function() {
	    $(this).children('ol').stop().toggle();
	});
	$(document).on({
	    keyup: function(e) {
	        if (e.keyCode == '13') {
	            login();
	        }
	    }
	});

</script>
    </body>
</html>
