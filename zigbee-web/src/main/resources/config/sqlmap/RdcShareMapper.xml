<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.smartcold.zigbee.manage.dao.RdcShareMapper">

	<insert id="insert" parameterType="map" keyProperty="id">
		INSERT INTO test (type)VALUES (#{key});
		<selectKey resultType="int" keyProperty="id" order="AFTER">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>


	<!-- 商品共享查询 -->
	<select id="getSEGDList" parameterType="map"
		resultType="com.smartcold.zigbee.manage.dto.RdcShareDTO">
		SELECT
		s.id,
		s.rdcID,
		s.releaseID,
		s.title,
		s.unitPrice,
		s.unit1,
		s.typeText,
		s.sqm,
		date_format(s.validStartTime,'%Y-%m-%d %H:%i:%s') validStartTime,
		date_format(s.validEndTime,'%Y-%m-%d %H:%i:%s') validEndTime,
		s.applyID,
		s.bookings,
		s.stauts,
		<!-- date_format(s.addtime, '%Y-%m-%d %H:%i:%s') addtime, -->
		<!-- date_format(s.updatetime,'%Y-%m-%d %H:%i:%s') updatetime, -->
		r.address,
		r. NAME,
		(SELECT location FROM filedata f WHERE f.belongid = r.id AND f.category =
		'storagePic' ORDER BY id DESC LIMIT 1 ) AS logo
		FROM
		shared_info s
		LEFT JOIN rdc r ON s.rdcID = r.id
		<!-- LEFT JOIN comm_mata_data c ON s.codeLave = c.type_code -->
		WHERE
		s.stauts = #{sstauts} and s.dataType=#{datatype}
		AND (CURRENT_TIMESTAMP () BETWEEN s.validStartTime AND s.validEndTime )
		<if test="type !=null and  type != ''"> and s.typeCode=#{type} </if>
		<if test="keyword !=null and  keyword != ''"> and s.title like '%${keyword}%' </if>  <!-- 关键字 -->
		<if test="provinceid !=null and  provinceid != ''"> and r.provinceid = #{provinceid} </if> <!-- 区域 -->
		<if test="goodtype !=null and  goodtype != ''"> and s.codeLave1 in (${goodtype})</if> <!-- 品类类型 -->
		GROUP BY
		s.id
		ORDER BY
		s.updatetime DESC
	</select>
	<!-- 配送查询 -->
	<select id="getSEPSList" parameterType="map"
		resultType="com.smartcold.zigbee.manage.dto.RdcShareDTO">
		<!-- SELECT type_name FROM comm_mata_data f WHERE f.source_type='ps_fm_type' 
			and f.type_code=1 LIMIT 1; SELECT s.id, s.rdcID, s.releaseID, s.title, s.note, 
			s.unit1, s.unit2, s.typeText, date_format(s.validStartTime,'%Y-%m-%d %H:%i:%s') 
			validStartTime, date_format(s.validEndTime,'%Y-%m-%d %H:%i:%s') validEndTime, 
			s.applyID, s.bookings, s.stauts, r.address, r.name, f.type_name codeLave1,f1.type_name 
			codeLave2, (SELECT location FROM filedata f WHERE f.belongid = r.id AND f.category 
			= 'storagePic' ORDER BY id DESC LIMIT 1) logo FROM shared_info s LEFT JOIN 
			rdc r ON s.rdcID = r.id left join comm_mata_data f on f.type_code=s.codeLave1 
			and f.source_type='ps_fm_type' left join comm_mata_data f1 on f1.type_code=s.codeLave2 
			and f.source_type='ps_cl_type' WHERE s.stauts = 1 and s.dataType=2 AND (CURRENT_TIMESTAMP 
			() BETWEEN s.validStartTime AND s.validEndTime) GROUP BY s.id ORDER BY s.updatetime 
			DESC -->
		SELECT
		s.id,
		s.rdcID,
		s.releaseID,
		s.title,
		s.unit1,
		s.unit2,
		s.typeText,
		s.attrvalue,
		date_format(s.validStartTime,'%Y-%m-%d %H:%i:%s') validStartTime,
		date_format(s.validEndTime,'%Y-%m-%d %H:%i:%s') validEndTime,
		s.applyID,
		s.bookings,
		s.stauts,
		<!-- r.address, -->
		<!-- r.name, -->
		(SELECT type_name FROM comm_mata_data f WHERE
		f.source_type='ps_fm_type' and f.type_code=s.codeLave1 LIMIT 1 )
		codeLave1,
		(SELECT location FROM filedata f WHERE f.belongid = r.id AND f.category =
		'storagePic' ORDER BY id DESC LIMIT 1 ) logo
		FROM
		shared_info s
		LEFT JOIN rdc r ON s.rdcID = r.id
		WHERE
		s.stauts = #{sstauts} and s.dataType=#{datatype} AND (CURRENT_TIMESTAMP ()
		BETWEEN s.validStartTime AND s.validEndTime )
		<if test="keyword !=null and  keyword != ''"> and s.title like '%${keyword}%' </if>  <!-- 关键字 -->
		<if test="carType !=null and  carType != ''"> and s.codeLave3 in (${carType}) </if>  <!-- codeLave3:车型 -->
		<if test="businessType !=null and  businessType != ''"> and s.codeLave1 in (${businessType}) </if>  <!-- codeLave1:业务类型 -->
		<if test="storagetempertype !=null and  storagetempertype != ''"> and s.codeLave2 in(${storagetempertype}) </if>  <!-- codeLave2:温度类型 -->
		GROUP BY
		s.id
		ORDER BY
		s.updatetime DESC
	</select>
	<!-- 睿库共享查询 -->
	<select id="getSERDCList" parameterType="map"
		resultType="com.smartcold.zigbee.manage.dto.RdcShareDTO">
		SELECT
		s.id,
		s.rdcID,
		s.releaseID,
		s.title,
		s.typeCode,
		s.typeText,
		s.unitPrice,
		s.unit1,
		s.sqm,
		date_format(s.validStartTime,'%Y-%m-%d %H:%i:%s') validStartTime,
		date_format(s.validEndTime,'%Y-%m-%d %H:%i:%s') validEndTime,
		s.applyID,
		s.bookings,
		s.stauts,
		<!-- date_format(s.addtime,'%Y-%m-%d %H:%i:%s') addtime, -->
		<!-- date_format(s.updatetime,'%Y-%m-%d %H:%i:%s') updatetime, -->
		r.address,
		r.name,
		r.coldtype,
		(SELECT location FROM filedata f WHERE f.belongid = r.id AND f.category =
		'storagePic' ORDER BY id DESC LIMIT 1 ) as logo
		FROM
		shared_info s
		LEFT JOIN rdc r ON s.rdcID = r.id
		LEFT JOIN rdcext t on s.rdcID=t.RDCID
		WHERE
		s.stauts = #{sstauts} and s.dataType=#{datatype}
		AND (CURRENT_TIMESTAMP () BETWEEN s.validStartTime AND s.validEndTime)
		<if test="type !=null and  type != ''"> and s.typeCode=#{type} </if>
		<if test="sqm !=null and  sqm != ''"> and ${sqm} </if>
		<if test="keyword !=null and  keyword != ''"> and r.name like '%${keyword}%' </if>  <!-- 关键字 -->
		<if test="provinceid !=null and  provinceid != ''"> and r.provinceid = #{provinceid} </if> <!-- 区域 -->
		<if test="managetype !=null and  managetype != ''"> and t.managetype in (${managetype})</if> <!-- 经营类型 -->
		<if test="storagetempertype !=null and  storagetempertype != ''"> and t.storagetempertype in (${storagetempertype})</if><!-- 
			温度类型 -->
		GROUP BY
		s.id
		ORDER BY
		s.updatetime DESC
	</select>
	<insert id="addshareInfo" parameterType="com.smartcold.zigbee.manage.dto.RdcShareDTO">
		INSERT INTO share_info (
		rdcID ,
		releaseID ,
		codeLave1 ,
		codeLave2 ,
		codeLave3 ,
		codeLave4 ,
		title ,
		dataType ,
		typeCode ,
		typeText ,
		unitPrice ,
		sqm ,
		unit ,
		unit1 ,
		unit2 ,
		validStartTime ,
		validEndTime ,
		applyID ,
		bookings ,
		attrvalue ,
		telephone ,
		note ,
		stauts ,
		stprovinceID ,
		stcityID ,
		staddress ,
		toprovinceID ,
		tocityID ,
		toaddress ,
		addtime ,
		updatetime ,
		)value(
		,#{ rdcID }
		,#{ releaseID }
		,#{ codeLave1 }
		,#{ codeLave2 }
		,#{ codeLave3 }
		,#{ codeLave4 }
		,#{ title }
		,#{ dataType }
		,#{ typeCode }
		,#{ typeText }
		,#{ unitPrice }
		,#{ sqm }
		,#{ unit }
		,#{ unit1 }
		,#{ unit2 }
		,#{ validStartTime }
		,#{ validEndTime }
		,#{ applyID }
		,#{ bookings }
		,#{ attrvalue }
		,#{ telephone }
		,#{ note }
		,#{ stauts }
		,#{ stprovinceID }
		,#{ stcityID }
		,#{ staddress }
		,#{ toprovinceID }
		,#{ tocityID }
		,#{ toaddress }
		,#{ addtime }
		,#{ updatetime }
    );
	</insert>
</mapper>